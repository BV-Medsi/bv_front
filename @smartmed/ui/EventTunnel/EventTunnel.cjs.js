"use strict";const t=require("vue"),E=require("@smartmed/ui/tokens"),_=require("@smartmed/utility/dom/timers"),g=require("@smartmed/utility/numbers");function w(){}const B={isEnable:!0},y={name:"EventTunnel"},R=t.defineComponent({...y,props:t.mergeDefaults({duration:{},eventsCount:{},preventOntouch:{type:Boolean},isEnable:{type:Boolean}},B),setup(f){const L=f,{duration:r,preventOntouch:N,eventsCount:T,isEnable:p}=t.toRefs(L),o=t.ref([r.value,0]),a=t.ref(0);let m={stop:w};const u=t.ref(performance.now()),v=t.ref(null),c=()=>{u.value=performance.now(),m=_.animationBasedSetInterval(e=>{const n=e-u.value;n>=r.value?(o.value=[r.value,o.value[1]+1],a.value=0,u.value=e):a.value=g.clamp(n/r.value,0,1)},r.value/T.value)},s=()=>{m.stop()},i=()=>s(),l=()=>{p.value&&(s(),c())};t.onBeforeUnmount(()=>{s(),v.value&&d(v.value)});const O=e=>{e.addEventListener("mouseenter",i,{passive:!0}),e.addEventListener("touchstart",i,{passive:!0}),e.addEventListener("touchend",l,{passive:!0}),e.addEventListener("mouseleave",l,{passive:!0})},d=e=>{e.removeEventListener("mouseenter",i),e.removeEventListener("touchstart",i),e.removeEventListener("touchend",l),e.removeEventListener("mouseleave",l)};return t.watch(r,e=>{s(),e&&c()}),t.watch(p,e=>{e?c():s()},{immediate:!0}),t.provide(E.EVENT_TUNNEL_TOKEN,t.readonly(o)),t.provide(E.EVENT_TUNNEL_PROGRESS_TOKEN,t.readonly(a)),t.provide(E.EVENT_TUNNEL_CONTROLLER_TOKEN,{reset:()=>{u.value=performance.now()}}),t.watch([N,v],([e,n])=>{n&&(e?O(n):d(n))},{immediate:!0}),(e,n)=>(t.openBlock(),t.createElementBlock("div",{ref_key:"host",ref:v},[t.renderSlot(e.$slots,"default",{progress:a.value,duration:o.value})],512))}});module.exports=R;
