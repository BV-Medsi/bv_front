var re=require("./InputCode.css");const e=require("vue"),$=require("@smartmed/ui/TransitionExpand"),E=require("@smartmed/utility/directives"),z=require("@smartmed/utility/dom/focus"),V=require("@smartmed/utility/maskito"),C=require("../_plugin-vue_export-helper-f246444f.js"),w=require("@smartmed/ui/SvgIcon"),I={length:6,size:"md",resendTimeoutSeconds:30,isLoading:!1},N=["tabindex","value","disabled","onKeydown"],T=e.defineComponent({__name:"InputCodeCell",props:{modelValue:{},size:{},tabindex:{},invalid:{type:Boolean},disabled:{type:Boolean}},emits:["update:modelValue","onFocus","onBackspace","onPaste"],setup(b,{expose:p,emit:i}){const t=V.useMaskito({mask:/\d/}),c=e.ref(!1),d=e.ref(!1),r=s=>{const n=s.target.value;n.length>1?i("onPaste",n):i("update:modelValue",n?Number(n):null)},v=()=>{d.value=!0,i("onFocus")},y=()=>{d.value=!1},m=()=>i("onBackspace"),_=s=>{var o;s.preventDefault(),s.stopPropagation();const f=(o=s.clipboardData)==null?void 0:o.getData("text"),n=f?f.replace(/\D/g,""):null;i("onPaste",n)},u=()=>{const s=t.value;s&&z.setNativeFocused(s)},k=s=>{c.value=s};return p({focus:u}),(s,f)=>e.withDirectives((e.openBlock(),e.createElementBlock("input",{ref_key:"nativeRef",ref:t,type:"text",inputmode:"numeric","data-automation-id":"smed-input-code-cell",tabindex:s.disabled?"-1":s.tabindex,value:s.modelValue,disabled:s.disabled,class:e.normalizeClass([s.$style.native,s.$style["native_"+s.size],d.value&&s.$style.native_focused,c.value&&s.$style.native_hovered,s.invalid&&s.$style.native_invalid,s.disabled&&s.$style.native_disabled]),onPaste:_,onInput:r,onFocus:v,onBlur:y,onKeydown:e.withKeys(m,["backspace"])},null,42,N)),[[e.unref(E.HoveredDirective),{onEvent:k}]])}}),S="_native_1fely_1",D="_native_sm_1fely_32",O="_native_md_1fely_40",F="_native_hovered_1fely_48",M="_native_focused_1fely_51",P="_native_invalid_1fely_54",q="_native_disabled_1fely_57",L={native:S,native_sm:D,native_md:O,native_hovered:F,native_focused:M,native_invalid:P,native_disabled:q},R={$style:L},U=C._export_sfc(T,[["__cssModules",R]]),A=["onKeydown"],K=1e3,j=e.defineComponent({__name:"Resend",props:{resendTimeoutSeconds:{},isLoading:{type:Boolean}},emits:["resendCode"],setup(b,{emit:p}){const i=b,{resendTimeoutSeconds:t,isLoading:c}=e.toRefs(i),d=e.ref(null),r=e.ref(t.value),v=e.computed(()=>r.value!==0),y=()=>{r.value=t.value,d.value=setInterval(()=>{r.value=r.value-1,v.value||m()},K)},m=()=>{d.value&&clearInterval(d.value)};e.onBeforeUnmount(()=>{m()}),e.watch(t,()=>{m(),y()},{immediate:!0});const _=()=>{c.value||p("resendCode")};return(u,k)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(u.$style.root)},[v.value?(e.openBlock(),e.createElementBlock("span",{key:0,"data-automation-id":"smed-resend-timer",class:e.normalizeClass(u.$style.timer)},"Выслать код повторно ("+e.toDisplayString(r.value)+" сек)",3)):(e.openBlock(),e.createElementBlock("span",{key:1,class:e.normalizeClass([u.$style.timer,u.$style.timer_clickable])},[e.createElementVNode("span",{"data-automation-id":"smed-resend-link",tabindex:"0",onKeydown:e.withKeys(_,["enter"]),onClick:_},"Выслать код повторно ",40,A),e.unref(c)?(e.openBlock(),e.createBlock(e.unref(w),{key:0,"data-automation-id":"smed-resend-code-spinner",name:"spinner",size:"sm",class:e.normalizeClass([u.$style.spinner,"smed-space_left-1"])},null,8,["class"])):e.createCommentVNode("",!0)],2))],2))}}),H="_root_8im9e_1",G="_timer_8im9e_5",J="_timer_clickable_8im9e_12",Q="_spinner_8im9e_20",W={root:H,timer:G,timer_clickable:J,spinner:Q},X={$style:W},Y=C._export_sfc(j,[["__cssModules",X]]),Z=e.createElementVNode("p",{class:"smed-text_body-sm"}," На введенный номер выслан СМС с кодом. ",-1),x=e.createElementVNode("p",{class:"smed-text_body-sm smed-space_bottom-4"}," Пожалуйста, введите его в поле ниже. ",-1),ee=e.defineComponent({name:"InputCode",__name:"InputCode",props:e.mergeDefaults({length:{},size:{},disabled:{type:Boolean},invalidText:{},resendTimeoutSeconds:{},isLoading:{type:Boolean}},I),emits:["submitCode","resendCode"],setup(b,{emit:p}){const i=b,t=e.ref(new Array(i.length).fill("_").map(()=>null)),c=e.ref([]),d=()=>t.value.findIndex(n=>n===null),r=()=>{const n=d(),o=c.value;if(n!==-1&&o[n]){o[n].focus();return}const l=c.value[c.value.length-1];n===-1&&l&&l.focus()},v=(n,o)=>{t.value=new Array(i.length).fill("_").map((l,a)=>t.value[a]!==null&&a!==n?t.value[a]:a===n?o:null),r()},y=()=>{r()},m=n=>{t.value[n]===null&&(t.value=new Array(i.length).fill("_").map((l,a)=>a>=n-1?null:t.value[a]),r())},_=n=>{const o=n-1,l=t.value;return n===l.length-1?l[o]!==null||l[n]!==null?"0":"-1":n===0?l[n]===null?"0":"-1":l[o]!==null&&l[n]===null?"0":"-1"},u=()=>{t.value=t.value.map(n=>null),r()},k=()=>{u(),p("resendCode")},s=n=>{const o=n.slice(0,i.length);if(o){if(o.length===i.length)t.value=new Array(i.length).fill("").map((l,a)=>Number(o[a]));else{let l=0;t.value=new Array(i.length).fill("").map((a,g)=>{const h=o[l],B=t.value[g];return B===null&&h?(l+=1,Number(h)):B})}r()}},f=n=>{n&&s(n)};return e.watch(t,n=>{n.every(l=>l!==null)&&p("submitCode",n.join(""))}),(n,o)=>(e.openBlock(),e.createElementBlock("div",null,[e.renderSlot(n.$slots,"label",{},()=>[Z,x,e.createElementVNode("p",{class:e.normalizeClass(["smed-text_body-sm smed-space_bottom-2",n.$style.label])}," Код из СМС ",2)]),e.createElementVNode("div",{class:e.normalizeClass(n.$style.root)},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.length,(l,a)=>(e.openBlock(),e.createBlock(U,{ref_for:!0,ref_key:"cells",ref:c,key:a,tabindex:_(a),"model-value":t.value[a],class:e.normalizeClass(n.$style.code),size:n.size,disabled:n.disabled,invalid:!!n.invalidText,"onUpdate:modelValue":g=>v(a,g),onOnFocus:y,onOnBackspace:g=>m(a),onOnPaste:f},null,8,["tabindex","model-value","class","size","disabled","invalid","onUpdate:modelValue","onOnBackspace"]))),128))],2),e.createVNode(e.unref($),{style:{display:"flex"},opened:!!n.invalidText},{default:e.withCtx(()=>[e.createElementVNode("p",{class:e.normalizeClass([n.$style.error,"smed-text_caption smed-space_top-2"])},e.toDisplayString(n.invalidText),3)]),_:1},8,["opened"]),n.disabled?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(Y,{key:0,class:"smed-space_top-2","is-loading":n.isLoading,"resend-timeout-seconds":n.resendTimeoutSeconds,onResendCode:k},null,8,["is-loading","resend-timeout-seconds"]))]))}}),ne="_root_tjp1l_1",se="_label_tjp1l_5",te="_code_tjp1l_9",oe="_error_tjp1l_13",le={root:ne,label:se,code:te,error:oe},ae={$style:le},ie=C._export_sfc(ee,[["__cssModules",ae]]);module.exports=ie;
