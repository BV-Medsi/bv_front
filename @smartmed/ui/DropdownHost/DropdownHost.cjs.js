var ye=require("./DropdownHost.css");const e=require("vue"),le=require("@smartmed/ui/ActiveZone"),se=require("@smartmed/ui/Portal"),ae=require("@smartmed/ui/Scrollbar"),q=require("@smartmed/ui/tokens"),ie=require("@smartmed/ui/use"),v=require("@smartmed/utility/dom/focus"),ue=require("../scrollbarTokens-475d4523.js"),ce=require("../_plugin-vue_export-helper-f246444f.js"),re=400,P=80,de={modelValue:!1,canOpen:!0,maxHeight:re,align:"right",direction:"bottom",customDropdownStyles:()=>({}),minHeight:P},fe=["onClick"],me={name:"DropdownHost"},ve=e.defineComponent({...me,props:e.mergeDefaults({modelValue:{type:Boolean},canOpen:{type:Boolean},minHeight:{},maxHeight:{},maxWidth:{},minWidth:{},align:{},direction:{},customDropdownStyles:{}},de),emits:["update:modelValue"],setup(U,{emit:w}){const C=U,i=8;function D(t,o,l){return t>=o&&t<=l}const a=e.ref(!!C.modelValue),{modelValue:I,canOpen:r,maxHeight:E,maxWidth:B,minHeight:g,direction:Z,minWidth:F,align:M}=e.toRefs(C),_=e.inject(q.DROPDOWN_HOST_TOKEN),O=e.inject(ue.SCROLLBAR_REF_TOKEN,null),V=e.inject(q.DROPDOWN_HOST_PIVOT_TOKEN,e.ref()),b=e.ref(null),y=e.ref(null),H=e.ref(null),f=e.ref(null),m=e.ref(null),$=e.ref(null),N=e.ref(null),W=e.ref(null),L=e.ref(!1);e.nextTick(()=>L.value=!0);const x=ie.useOverscroll("all",t=>t.native),k=e.computed(()=>{var t;return V.value===void 0?((t=W.value)==null?void 0:t.activeZone)??null:V.value}),p=e.computed(()=>x.value&&x.value.native),T=e.computed(()=>O&&O.value||window);e.watch(r,(t,o)=>{o&&!t&&(w("update:modelValue",!1),a.value=!1)});const j=()=>!_||!_.value?{left:0,top:document.body.clientHeight,width:document.body.clientWidth}:_.value.element.getBoundingClientRect(),G=e.computed(()=>{const t=B&&B.value,o=F&&F.value,l=b.value;return{"max-width":t?`${t}px`:null,"min-width":o?`${o}px`:null,"max-height":l?`${l}px`:null,top:y.value,bottom:H.value,left:f.value,right:m.value,width:$.value}}),A=()=>{r.value&&(w("update:modelValue",!a.value),a.value=!a.value)},z=()=>{a.value&&(w("update:modelValue",!1),a.value=!1)},X=t=>{t||z()},K=e.ref(!1),J=t=>{const o=window.innerHeight,l=t.top-i,s=o-t.bottom-i,n=Math.min(E.value,o-i),d=Math.min(Math.max(p.value.getBoundingClientRect().height,g.value||P),n);let u=null;switch(Z.value){case"top":l>=(g.value||d)&&(u="top");break;case"bottom":s>=(g.value||d)&&(u="bottom");break}return u===null&&(K.value&&l>=d?u="top":s>=d?u="bottom":u=s>=l?"bottom":"top"),u},c=()=>{if(!k.value||!p.value)return;const t=k.value.getBoundingClientRect(),o=j();Q(t,o),Y(t,o),ee(t)},Q=(t,o)=>{const l=window.innerHeight,s=Math.min(E.value,l-i*2),n=i,d=t.top-n,u=l-t.bottom-n,R=J(t);K.value=R==="top",R==="top"?(b.value=Math.min(s,d),y.value="auto",H.value=`${o.bottom-t.top+i}px`):(b.value=Math.min(s,u),y.value=`${t.bottom-o.top+i}px`,H.value="auto")},Y=(t,o)=>{const s=Math.ceil(t.left-o.left-0),n=Math.floor(o.right-t.right-0);switch(M.value){case"left":n+i>window.innerWidth||D(s+i,0,window.innerWidth)?(f.value=`${s}px`,m.value="auto"):(f.value="auto",m.value=`${n}px`);break;case"right":D(n+i,0,window.innerWidth)||s+i>window.innerWidth?(f.value="auto",m.value=`${n}px`):(f.value=`${s}px`,m.value="auto")}},ee=t=>{$.value=`${t.width}px`};e.onMounted(()=>{a.value&&r.value&&c()}),e.onUpdated(()=>{a.value&&r.value&&c()}),e.watch(a,t=>{r.value&&(t?(T.value.addEventListener("scroll",c),window.addEventListener("resize",c)):(T.value.removeEventListener("scroll",c),window.removeEventListener("resize",c)))});let h=null;e.onBeforeUnmount(()=>{T.value.removeEventListener("scroll",c),window.removeEventListener("resize",c),h&&clearTimeout(h)});const te=()=>{!a.value&&r.value&&(A(),h=setTimeout(()=>{const t=v.getClosestKeyboardFocusable(N.value,!1,p.value);h=null,t&&t.id!=="smed_autoUnfocusableBottom"&&t.id!=="smed_autoUnfocusableTop"&&v.setNativeFocused(t)}))},oe=()=>{S(!0)},ne=()=>{S(!1)},S=t=>{const o=k.value,{ownerDocument:l}=o,s=l?l.body:o;let n=v.getClosestKeyboardFocusable(o,t,s);for(;n!==null&&o.contains(n);)n=v.getClosestKeyboardFocusable(n,t,s);n!==null&&v.setNativeFocused(n)};return e.watch(I,t=>{a.value=t},{immediate:!0}),(t,o)=>(e.openBlock(),e.createBlock(e.unref(le),{ref_key:"host",ref:W,class:e.normalizeClass(t.$style.container),child:p.value,onKeydown:[e.withKeys(e.withModifiers(z,["stop","prevent"]),["esc"]),e.withKeys(e.withModifiers(te,["stop","prevent"]),["down"])],onActiveZoneChanged:X},{default:e.withCtx(()=>[e.createElementVNode("div",{class:e.normalizeClass(t.$style.content),onClick:e.withModifiers(A,["stop","prevent"])},[e.renderSlot(t.$slots,"default")],10,fe),L.value?(e.openBlock(),e.createBlock(e.unref(se),{key:0,"append-to":"#smed_dropdown-host"},{default:e.withCtx(()=>[e.unref(r)?(e.openBlock(),e.createBlock(e.Transition,{key:0,name:"fade"},{default:e.withCtx(()=>[a.value?(e.openBlock(),e.createBlock(e.unref(ae),{key:0,ref_key:"dropdownRef",ref:x,"data-automation-id":"smed-dropdown__scrollbar",class:e.normalizeClass([t.$style.dropdown,t.$style["dropdown_"+e.unref(M)]]),style:e.normalizeStyle({...t.customDropdownStyles,...G.value})},{default:e.withCtx(()=>[e.createElementVNode("div",{id:"smed_autoUnfocusableTop",ref_key:"topFocusableElement",ref:N,tabindex:"0",onFocus:oe},null,544),e.renderSlot(t.$slots,"dropdown"),e.createElementVNode("div",{id:"smed_autoUnfocusableBottom",tabindex:"0",onFocus:ne},null,32)]),_:3},8,["class","style"])):e.createCommentVNode("",!0)]),_:3})):e.createCommentVNode("",!0)]),_:3})):e.createCommentVNode("",!0)]),_:3},8,["class","child","onKeydown"]))}}),pe="_container_zhy4y_1",he="_content_zhy4y_6",we="_dropdown_zhy4y_13",ge={container:pe,content:he,dropdown:we},_e={$style:ge},be=ce._export_sfc(ve,[["__cssModules",_e]]);module.exports=be;
