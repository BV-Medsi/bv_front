var _e=require("./DropdownHost.css");const e=require("vue"),le=require("@smartmed/ui/ActiveZone"),ae=require("@smartmed/ui/Portal"),se=require("@smartmed/ui/Scrollbar"),D=require("@smartmed/ui/tokens"),ie=require("@smartmed/ui/use"),v=require("@smartmed/utility/dom/focus"),ue=require("../_plugin-vue_export-helper-f246444f.js"),ce=400,U=80,re={modelValue:!1,canOpen:!0,maxHeight:ce,align:"right",direction:"bottom",customDropdownStyles:()=>({}),minHeight:U},de=["onClick"],i=8,me=e.defineComponent({name:"DropdownHost",__name:"DropdownHost",props:e.mergeDefaults({modelValue:{type:Boolean},canOpen:{type:Boolean},minHeight:{},maxHeight:{},maxWidth:{},minWidth:{},align:{},direction:{},customDropdownStyles:{}},re),emits:["update:modelValue"],setup(q,{emit:w}){const T=q;function E(t,o,l){return t>=o&&t<=l}const s=e.ref(!!T.modelValue),{modelValue:I,canOpen:r,maxHeight:B,maxWidth:F,minHeight:g,direction:Z,minWidth:M,align:O}=e.toRefs(T),_=e.inject(D.DROPDOWN_HOST_TOKEN),V=e.inject(D.SCROLLBAR_REF_TOKEN,null),$=e.inject(D.DROPDOWN_HOST_PIVOT_TOKEN,e.ref()),y=e.ref(null),b=e.ref(null),H=e.ref(null),m=e.ref(null),f=e.ref(null),N=e.ref(null),W=e.ref(null),L=e.ref(null),A=e.ref(!1);e.nextTick(()=>A.value=!0);const x=ie.useOverscroll("all",t=>t.native),k=e.computed(()=>{var t;return $.value===void 0?((t=L.value)==null?void 0:t.activeZone)??null:$.value}),p=e.computed(()=>x.value&&x.value.native),C=e.computed(()=>V&&V.value||window);e.watch(r,(t,o)=>{o&&!t&&(w("update:modelValue",!1),s.value=!1)});const j=()=>!_||!_.value?{left:0,top:document.body.clientHeight,width:document.body.clientWidth}:_.value.element.getBoundingClientRect(),G=e.computed(()=>{const t=F&&F.value,o=M&&M.value,l=y.value;return{"max-width":t?`${t}px`:null,"min-width":o?`${o}px`:null,"max-height":l?`${l}px`:null,top:b.value,bottom:H.value,left:m.value,right:f.value,width:N.value}}),z=()=>{r.value&&(w("update:modelValue",!s.value),s.value=!s.value)},K=()=>{s.value&&(w("update:modelValue",!1),s.value=!1)},X=t=>{t||K()},S=e.ref(!1),J=t=>{const o=window.innerHeight,l=t.top-i,a=o-t.bottom-i,n=Math.min(B.value,o-i),d=Math.min(Math.max(p.value.getBoundingClientRect().height,g.value||U),n);let u=null;switch(Z.value){case"top":l>=(g.value||d)&&(u="top");break;case"bottom":a>=(g.value||d)&&(u="bottom");break}return u===null&&(S.value&&l>=d?u="top":a>=d?u="bottom":u=a>=l?"bottom":"top"),u},c=()=>{if(!k.value||!p.value)return;const t=k.value.getBoundingClientRect(),o=j();Q(t,o),Y(t,o),ee(t)},Q=(t,o)=>{const l=window.innerHeight,a=Math.min(B.value,l-i*2),n=i,d=t.top-n,u=l-t.bottom-n,P=J(t);S.value=P==="top",P==="top"?(y.value=Math.min(a,d),b.value="auto",H.value=`${o.bottom-t.top+i}px`):(y.value=Math.min(a,u),b.value=`${t.bottom-o.top+i}px`,H.value="auto")},Y=(t,o)=>{const a=Math.ceil(t.left-o.left-0),n=Math.floor(o.right-t.right-0);switch(O.value){case"left":n+i>window.innerWidth||E(a+i,0,window.innerWidth)?(m.value=`${a}px`,f.value="auto"):(m.value="auto",f.value=`${n}px`);break;case"right":E(n+i,0,window.innerWidth)||a+i>window.innerWidth?(m.value="auto",f.value=`${n}px`):(m.value=`${a}px`,f.value="auto")}},ee=t=>{N.value=`${t.width}px`};e.onMounted(()=>{s.value&&r.value&&c()}),e.onUpdated(()=>{s.value&&r.value&&c()}),e.watch(s,t=>{r.value&&(t?(C.value.addEventListener("scroll",c),window.addEventListener("resize",c)):(C.value.removeEventListener("scroll",c),window.removeEventListener("resize",c)))});let h=null;e.onBeforeUnmount(()=>{C.value.removeEventListener("scroll",c),window.removeEventListener("resize",c),h&&clearTimeout(h)});const te=()=>{r.value&&(s.value||z(),h=setTimeout(()=>{const t=v.getClosestKeyboardFocusable(W.value,!1,p.value);h=null,t&&t.id!=="smed_autoUnfocusableBottom"&&t.id!=="smed_autoUnfocusableTop"&&v.setNativeFocused(t)}))},oe=()=>{R(!0)},ne=()=>{R(!1)},R=t=>{const o=k.value,{ownerDocument:l}=o,a=l?l.body:o;let n=v.getClosestKeyboardFocusable(o,t,a);for(;n!==null&&o.contains(n);)n=v.getClosestKeyboardFocusable(n,t,a);n!==null&&v.setNativeFocused(n)};return e.watch(I,t=>{s.value=t},{immediate:!0}),(t,o)=>(e.openBlock(),e.createBlock(e.unref(le),{ref_key:"host",ref:L,class:e.normalizeClass(t.$style.container),child:p.value,onKeydown:[e.withKeys(e.withModifiers(K,["stop","prevent"]),["esc"]),e.withKeys(e.withModifiers(te,["stop","prevent"]),["down"])],onActiveZoneChanged:X},{default:e.withCtx(()=>[e.createElementVNode("div",{class:e.normalizeClass(t.$style.content),onClick:e.withModifiers(z,["stop","prevent"])},[e.renderSlot(t.$slots,"default")],10,de),A.value?(e.openBlock(),e.createBlock(e.unref(ae),{key:0,"append-to":"#smed_dropdown-host"},{default:e.withCtx(()=>[e.unref(r)?(e.openBlock(),e.createBlock(e.Transition,{key:0,name:"fade"},{default:e.withCtx(()=>[s.value?(e.openBlock(),e.createBlock(e.unref(se),{key:0,ref_key:"dropdownRef",ref:x,"data-automation-id":"smed-dropdown__scrollbar",class:e.normalizeClass([t.$style.dropdown,t.$style["dropdown_"+e.unref(O)]]),style:e.normalizeStyle({...t.customDropdownStyles,...G.value})},{default:e.withCtx(()=>[e.createElementVNode("div",{id:"smed_autoUnfocusableTop",ref_key:"topFocusableElement",ref:W,tabindex:"0",onFocus:oe},null,544),e.renderSlot(t.$slots,"dropdown"),e.createElementVNode("div",{id:"smed_autoUnfocusableBottom",tabindex:"0",onFocus:ne},null,32)]),_:3},8,["class","style"])):e.createCommentVNode("",!0)]),_:3})):e.createCommentVNode("",!0)]),_:3})):e.createCommentVNode("",!0)]),_:3},8,["class","child","onKeydown"]))}}),fe="_container_zhy4y_1",ve="_content_zhy4y_6",pe="_dropdown_zhy4y_13",he={container:fe,content:ve,dropdown:pe},we={$style:he},ge=ue._export_sfc(me,[["__cssModules",we]]);module.exports=ge;
